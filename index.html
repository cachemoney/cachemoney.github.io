
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Ruby on Rails, Online Marketing and Analytics</title>
  <meta name="author" content="Robin Paul">

  
  <meta name="description" content="Tweet Refactoring User Registration to Its Own Service Object Jul 9th, 2013 A quick look at the users_controller.rb shows that the create action is &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://cachemoney.github.io/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Ruby on Rails, Online Marketing and Analytics" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-41313989-1', 'cachemoney.github.io');
  ga('send', 'pageview');

</script>

</head>

<body >
  <header role="banner" id="sidebar">
    <!-- Logo -->
<aside id="logo" class="clearfix">
  <div class="clearfix">
    <a href="/">Ruby on Rails, Online Marketing and Analytics</a>
  </div>
</aside>

<ul id="menu">

  <li class="title">
    <h1 id="title"><a href="/">Ruby on Rails, Online Marketing and Analytics</a></h1>
  </li>


  <li class="subtitle">
    <h2 id="subtitle">A Technology Entrepreneur in TX</h2>
  </li>

  <li class="link">
    <a href="/about/">about</a>
  </li>

  <li class="link">
    <a href="http://twitter.com/pobinraul/">twitter</a>
  </li>


  <li class="link">
    <a href="http://github.com/cachemoney/">github</a>
  </li>


  <li class="link">
    <a href="http://linkedin.com/in/robinpaul00/">linkedIn</a>
  </li>  

  <li class="link rss">
    <a href="/atom.xml">rss feed</a>
  </li>
</ul>


<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:cachemoney.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>


<!-- Octopress Love -->
<!-- <aside id="octopress_linkback">
  <a href="http://octopress.org/">
    <span class="unicode_square">
      <span class="unicode_circle">
        &nbsp;
      </span>
    </span>
    <span class="octopress">Powered by Octopress</span>
  </a>
</aside> -->

  </header>
  <section id="main">
      
  
  
    <article class="post">
      <div class="sharing-box">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://cachemoney.github.io/index.html" data-via="pobinraul" data-counturl="http://cachemoney.github.io/index.html" data-size="large">Tweet</a>
  
  
  
</div>

      
  <header>
    
      <h2 class="entry-title">
        
        <a href="/blog/2013/07/09/refactoring-user-registration-to-its-own-service-object/">Refactoring User Registration to Its Own Service Object</a>
        
      </h2>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-09T21:36:00-05:00" pubdate data-updated="true">Jul 9<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <p>A quick look at the users_controller.rb shows that the create action is starting to look rather bloated. When I create a user theres several things that need to happen.</p>


  
  
    <footer>
      <a rel="full-article" href="/blog/2013/07/09/refactoring-user-registration-to-its-own-service-object/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article class="post">
      <div class="sharing-box">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://cachemoney.github.io/index.html" data-via="pobinraul" data-counturl="http://cachemoney.github.io/index.html" data-size="large">Tweet</a>
  
  
  
</div>

      
  <header>
    
      <h2 class="entry-title">
        
        <a href="/blog/2013/07/02/refactoring-to-simplify-domain-models/">Refactoring to Simplify Domain Models</a>
        
      </h2>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-02T22:02:00-05:00" pubdate data-updated="true">Jul 2<span>nd</span>, 2013</time>
        
      </p>
    
  </header>


  <h3>Policy Objects</h3>

<p>Policy Objects can be used to encapsulate a business rule which involves more complex read operations.  For the myFlix app, I can add logic that can group Users into certain roles(or policies) and gran them access to certain features in the app.  For example, those who have paid or those who have signed-up x years ago can be placed in special groups.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">ActiveUserPolicy</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@user</span> <span class="o">=</span> <span class="n">user</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">premium?</span>
</span><span class='line'>    <span class="vi">@user</span><span class="o">.</span><span class="n">created_at</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="o">.</span><span class="n">years</span><span class="o">.</span><span class="n">ago</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Domain Objects</h3>

<p>Domain Objects are objects for domain models. But sometimes, we don&rsquo;t have models that map to a database table.  Lets say for example, we were storing a credit balance in the user&rsquo;s table. There could be logic in an app that needs to update this balance, but in order to do that you always have to reference the @user to get the balance and the reference the @user again to save the balance.  You can abstract this &ldquo;Credit&rdquo; into its own domain object class, so that it can be used elsewhere and also make it easier to test.  To test Credit domain object a user, you don&rsquo;t have to worry about doing post/get actions to a controller, you can test the model separately.</p>

<h3>Service Objects</h3>

<p>Abstracting code from models or controllers to Service Objects is another way to refactor code in an application. In myFlix, I will refractor the User Signup process into an service object, that handles , charging the customer using my 1) custom Stripe API wrapper, 2) Saving the User to the database, 3) deploy welcome emails and 4) creating friendship creations if an invitation token is present. This can simplify the controller tests, as user registration unit tests can be targeted to the service object now.</p>

<figure class='code'><figcaption><span>/services/user_registration.rb </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">UserRegistration</span>
</span><span class='line'>  <span class="kp">attr_accessor</span> <span class="ss">:user</span>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:token</span><span class="p">,</span> <span class="ss">:invite_token</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">invite_token</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@token</span> <span class="o">=</span> <span class="n">token</span>
</span><span class='line'>    <span class="vi">@user</span> <span class="o">=</span> <span class="n">user</span>
</span><span class='line'>    <span class="vi">@invite_token</span> <span class="o">=</span> <span class="n">invite_token</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">charge_card</span>
</span><span class='line'>    <span class="ss">StripeWrapper</span><span class="p">:</span><span class="ss">:Charge</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">amount</span><span class="p">:</span> <span class="mi">999</span><span class="p">,</span> <span class="ss">currency</span><span class="p">:</span> <span class="s1">&#39;usd&#39;</span><span class="p">,</span> <span class="ss">card</span><span class="p">:</span> <span class="vi">@token</span><span class="p">,</span> <span class="ss">description</span><span class="p">:</span> <span class="vi">@user</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">register_user</span>
</span><span class='line'>    <span class="vi">@user</span><span class="o">.</span><span class="n">save</span>
</span><span class='line'>    <span class="n">handle_invitation</span> <span class="k">if</span> <span class="vi">@invite_token</span><span class="o">.</span><span class="n">present?</span>
</span><span class='line'>    <span class="no">AppMailer</span><span class="o">.</span><span class="n">delay</span><span class="o">.</span><span class="n">welcome_email</span><span class="p">(</span><span class="vi">@user</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">handle_invitation</span>
</span><span class='line'>      <span class="n">invitation</span> <span class="o">=</span> <span class="no">Invite</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">token</span><span class="p">:</span> <span class="vi">@invite_token</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
</span><span class='line'>      <span class="vi">@user</span><span class="o">.</span><span class="n">follow</span><span class="p">(</span><span class="n">invitation</span><span class="o">.</span><span class="n">inviter</span><span class="p">)</span>
</span><span class='line'>      <span class="n">invitation</span><span class="o">.</span><span class="n">inviter</span><span class="o">.</span><span class="n">follow</span><span class="p">(</span><span class="vi">@user</span><span class="p">)</span>
</span><span class='line'>      <span class="n">invitation</span><span class="o">.</span><span class="n">update_column</span><span class="p">(</span><span class="ss">:token</span><span class="p">,</span> <span class="kp">nil</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Reference:</p>

<p>1)  <a href="http://blog.codeclimate.com/blog/2012/10/17/7-ways-to-decompose-fat-activerecord-models/">http://blog.codeclimate.com/blog/2012/10/17/7-ways-to-decompose-fat-activerecord-models/</a></p>

<p>2)  <a href="http://blog.steveklabnik.com/posts/2011-09-06-the-secret-to-rails-oo-design">http://blog.steveklabnik.com/posts/2011-09-06-the-secret-to-rails-oo-design</a></p>

  
  


    </article>
  
  
    <article class="post">
      <div class="sharing-box">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://cachemoney.github.io/index.html" data-via="pobinraul" data-counturl="http://cachemoney.github.io/index.html" data-size="large">Tweet</a>
  
  
  
</div>

      
  <header>
    
      <h2 class="entry-title">
        
        <a href="/blog/2013/06/24/show-me-the-money-with-stripe-payment-processing-integration/">Show Me the Money With Stripe Payment Processing Integration</a>
        
      </h2>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-24T23:56:00-05:00" pubdate data-updated="true">Jun 24<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <p>Processing payments, is probably one of the most important functions that any app can have.  Luckily with Stripe, their API is extremely easy to use. In order to be PCI compliant, stripe.js handles sending sensitive fincancial information to Stripe&rsquo;s server from your form.</p>

<p>Once Stripe sends the credit card data to their servers they send back an authorization token.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Stripe</span><span class="p">:</span><span class="ss">:Token</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
</span><span class='line'>    <span class="ss">:card</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="ss">:number</span> <span class="o">=&gt;</span> <span class="s2">&quot;4242424242424242&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">:exp_month</span> <span class="o">=&gt;</span> <span class="mi">7</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">:exp_year</span> <span class="o">=&gt;</span> <span class="mi">2014</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">:cvc</span> <span class="o">=&gt;</span> <span class="mi">314</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">token</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:stripeToken</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="k">begin</span>
</span><span class='line'>  <span class="n">charge</span> <span class="o">=</span> <span class="ss">Stripe</span><span class="p">:</span><span class="ss">:Charge</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
</span><span class='line'>    <span class="ss">:amount</span> <span class="o">=&gt;</span> <span class="mi">1000</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">:currency</span> <span class="o">=&gt;</span> <span class="s2">&quot;usd&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">:card</span> <span class="o">=&gt;</span> <span class="n">token</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">:description</span> <span class="o">=&gt;</span> <span class="s2">&quot;robin@example.com&quot;</span>
</span><span class='line'>  <span class="p">)</span>
</span><span class='line'><span class="k">rescue</span> <span class="ss">Stripe</span><span class="p">:</span><span class="ss">:CardError</span> <span class="o">=&gt;</span> <span class="n">e</span>
</span><span class='line'>  <span class="c1"># The card has been declined</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Lets say we want to write a wrapper around this Stripe&rsquo;s API. You can hardcode values based on business rules. i.e currency: usd, or amount: 999</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">StripeWrapper</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Charge</span>
</span><span class='line'>    <span class="kp">attr_reader</span> <span class="ss">:response</span><span class="p">,</span> <span class="ss">:status</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
</span><span class='line'>      <span class="vi">@response</span> <span class="o">=</span> <span class="n">response</span>
</span><span class='line'>      <span class="vi">@status</span> <span class="o">=</span> <span class="n">status</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">create</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">{})</span>
</span><span class='line'>      <span class="k">begin</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="ss">Stripe</span><span class="p">:</span><span class="ss">:Charge</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">amount</span><span class="p">:</span> <span class="n">options</span><span class="o">[</span><span class="ss">:amount</span><span class="o">]</span><span class="p">,</span> <span class="ss">currency</span><span class="p">:</span> <span class="s1">&#39;usd&#39;</span><span class="p">,</span> <span class="ss">card</span><span class="p">:</span> <span class="n">options</span><span class="o">[</span><span class="ss">:card</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>        <span class="kp">new</span><span class="p">(</span> <span class="n">response</span><span class="p">,</span> <span class="ss">:success</span><span class="p">)</span>
</span><span class='line'>      <span class="k">rescue</span> <span class="ss">Stripe</span><span class="p">:</span><span class="ss">:CardError</span> <span class="o">=&gt;</span> <span class="n">e</span>
</span><span class='line'>        <span class="kp">new</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="ss">:error</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">success?</span>
</span><span class='line'>      <span class="n">status</span> <span class="o">==</span> <span class="ss">:success</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">error_message</span>
</span><span class='line'>      <span class="n">response</span><span class="o">.</span><span class="n">message</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>References:</p>

<p>1) <a href="https://stripe.com/docs">https://stripe.com/docs</a></p>

  
  


    </article>
  
  
    <article class="post">
      <div class="sharing-box">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://cachemoney.github.io/index.html" data-via="pobinraul" data-counturl="http://cachemoney.github.io/index.html" data-size="large">Tweet</a>
  
  
  
</div>

      
  <header>
    
      <h2 class="entry-title">
        
        <a href="/blog/2013/06/16/serving-static-assets-with-on-s3-with-carrierwave/">Serving Static Assets With on S3 With CarrierWave</a>
        
      </h2>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-16T23:55:00-05:00" pubdate data-updated="true">Jun 16<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <p>The next action-packed feature I&rsquo;m adding to myFlix is file upload processing.  With Carrierwave its fairly easy to configure your app to use it.</p>


  
  
    <footer>
      <a rel="full-article" href="/blog/2013/06/16/serving-static-assets-with-on-s3-with-carrierwave/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article class="post">
      <div class="sharing-box">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://cachemoney.github.io/index.html" data-via="pobinraul" data-counturl="http://cachemoney.github.io/index.html" data-size="large">Tweet</a>
  
  
  
</div>

      
  <header>
    
      <h2 class="entry-title">
        
        <a href="/blog/2013/06/15/using-unicorn-on-heroku-to-improve-concurrency/">Using Unicorn on Heroku to Improve Concurrency</a>
        
      </h2>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-15T23:53:00-05:00" pubdate data-updated="true">Jun 15<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <p>The default configuration in Heroku uses Webrick(?) as the default webserver.  They recommend that you use Unicorn, which is a Rack HTTP server that can run multiple ruby processes in a single dyno.</p>

<p>You can control how many of these ruby processes that unicorn will use with <code>worker_processes Integer(ENV["WEB_CONCURRENCY"] || 3)</code> in your Procfile.</p>

<p>Now that I have redis being used to process workers, I could use Foreman to start all my services to mimic a production environment.  <code>foreman start</code> will read a Procfile in the Rails root directory and start up (web)workers on port 5000.</p>

<p>References:
1. <a href="https://devcenter.heroku.com/articles/rails-unicorn">https://devcenter.heroku.com/articles/rails-unicorn</a>
2. <a href="https://github.com/blog/517-unicorn">https://github.com/blog/517-unicorn</a></p>

  
  


    </article>
  
  
    <article class="post">
      <div class="sharing-box">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://cachemoney.github.io/index.html" data-via="pobinraul" data-counturl="http://cachemoney.github.io/index.html" data-size="large">Tweet</a>
  
  
  
</div>

      
  <header>
    
      <h2 class="entry-title">
        
        <a href="/blog/2013/06/13/background-jobs-with-sidekiq-and-redis/">Background Jobs With Sidekiq and Redis</a>
        
      </h2>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-13T23:53:00-05:00" pubdate data-updated="true">Jun 13<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <p>One thing I noticed is after completing the new user registration form or the Invite a Friend form, there would be a time where the application just sits there(usually less than 2 seconds) before it redirects to the success view.  This is happening because
ActionMailer is dispatching an email to the Mail Deliveries queue, and in my development environment, connecting to GMail.</p>


  
  
    <footer>
      <a rel="full-article" href="/blog/2013/06/13/background-jobs-with-sidekiq-and-redis/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article class="post">
      <div class="sharing-box">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://cachemoney.github.io/index.html" data-via="pobinraul" data-counturl="http://cachemoney.github.io/index.html" data-size="large">Tweet</a>
  
  
  
</div>

      
  <header>
    
      <h2 class="entry-title">
        
        <a href="/blog/2013/06/06/simplifying-models-with-concerns/">Simplifying Models With Concerns</a>
        
      </h2>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-06T23:50:00-05:00" pubdate data-updated="true">Jun 6<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <p>In the effort for simplifying the complexity of models, we can abstract methods in from a model that can be shared across all other models.  In the foreseeable future, its makes sense to remove the token logic out of the invites module, and put it into an ActiveSupport::Concern</p>


  
  
    <footer>
      <a rel="full-article" href="/blog/2013/06/06/simplifying-models-with-concerns/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article class="post">
      <div class="sharing-box">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://cachemoney.github.io/index.html" data-via="pobinraul" data-counturl="http://cachemoney.github.io/index.html" data-size="large">Tweet</a>
  
  
  
</div>

      
  <header>
    
      <h2 class="entry-title">
        
        <a href="/blog/2013/06/02/tokens-to-anonymize-your-data/">Tokens to Anonymize Your Data</a>
        
      </h2>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-02T23:49:00-05:00" pubdate data-updated="true">Jun 2<span>nd</span>, 2013</time>
        
      </p>
    
  </header>


  <p>The next feature in our app is being able to invite a friend using ActionMailer with a tracking link, so if they signup via that link, each of you will become friends, oh and do it the TDD way, including feature specs.</p>


  
  
    <footer>
      <a rel="full-article" href="/blog/2013/06/02/tokens-to-anonymize-your-data/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article class="post">
      <div class="sharing-box">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://cachemoney.github.io/index.html" data-via="pobinraul" data-counturl="http://cachemoney.github.io/index.html" data-size="large">Tweet</a>
  
  
  
</div>

      
  <header>
    
      <h2 class="entry-title">
        
        <a href="/blog/2013/06/01/actionmailer-in-rail-communicating-with-users/">ActionMailer in Rails: Communicating With Users</a>
        
      </h2>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-01T23:49:00-05:00" pubdate data-updated="true">Jun 1<span>st</span>, 2013</time>
        
      </p>
    
  </header>


  <p>After doing email marketing for several years, and building a building out a strategy for revenue from scratch, learning ActionMailer was really exciting.</p>


  
  
    <footer>
      <a rel="full-article" href="/blog/2013/06/01/actionmailer-in-rail-communicating-with-users/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article class="post">
      <div class="sharing-box">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://cachemoney.github.io/index.html" data-via="pobinraul" data-counturl="http://cachemoney.github.io/index.html" data-size="large">Tweet</a>
  
  
  
</div>

      
  <header>
    
      <h2 class="entry-title">
        
        <a href="/blog/2013/05/31/friendships-with-self-referential-associations/">Creating Friendships With Self Referential Associations</a>
        
      </h2>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-31T23:47:00-05:00" pubdate data-updated="true">May 31<span>st</span>, 2013</time>
        
      </p>
    
  </header>


  <p>Now, we&rsquo;re allowing users of myFlix to create &lsquo;friendships&rsquo; by following other users.  Self joins will allow us to do this with out the need to create extraneous tables.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">validates_presence_of</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">:full_name</span>
</span><span class='line'>  <span class="n">validates_uniqueness_of</span> <span class="ss">:email</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">has_secure_password</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:following_relationships</span><span class="p">,</span> <span class="n">class_name</span><span class="p">:</span> <span class="s2">&quot;Relationship&quot;</span><span class="p">,</span> <span class="n">foreign_key</span><span class="p">:</span> <span class="ss">:follower_id</span>
</span><span class='line'>  <span class="n">has_many</span>  <span class="ss">:leading_relationships</span><span class="p">,</span> <span class="n">class_name</span><span class="p">:</span> <span class="s2">&quot;Relationship&quot;</span><span class="p">,</span> <span class="n">foreign_key</span><span class="p">:</span> <span class="ss">:leader_id</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Relationship</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="c1">#join table to associate friends to a user</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:follower</span><span class="p">,</span> <span class="n">class_name</span><span class="p">:</span> <span class="s2">&quot;User&quot;</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:leader</span><span class="p">,</span> <span class="n">class_name</span><span class="p">:</span> <span class="s2">&quot;User&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can access a users followers with <code>@user.following_relationships</code> or they are following with <code>@user.leading_relationships</code></p>

  
  


    </article>
  

    <nav role="navigation" id="pagination">
  <span class="next">
    <a href="/blog/page/2/" rel="next">Continue &rarr;</a>
  </span>


</nav>
  </section>
  

  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




</body>
</html>
